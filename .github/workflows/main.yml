name: Deploy to VPS

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Install sshpass for password authentication
      run: |
        sudo apt-get update
        sudo apt-get install -y sshpass

    - name: Deploy files using password
      run: |
        # –ö–æ–ø–∏—Ä—É–µ–º —Ñ–∞–π–ª—ã –Ω–∞ —Å–µ—Ä–≤–µ—Ä –∏—Å–ø–æ–ª—å–∑—É—è –ø–∞—Ä–æ–ª—å
        sshpass -p '${{ secrets.SSH_PASSWORD }}' \
          scp -o StrictHostKeyChecking=no -r \
          --exclude='.git' \
          --exclude='.github' \
          ./* root@89.111.155.196:/var/www/fox-net.site/

    - name: Set permissions and reload
      run: |
        sshpass -p '${{ secrets.SSH_PASSWORD }}' \
          ssh -o StrictHostKeyChecking=no root@89.111.155.196 << 'EOF'
          # –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–∞–≤–∞
          chown -R www-data:www-data /var/www/fox-net.site/
          chmod -R 755 /var/www/fox-net.site/
          
          # –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º nginx
          nginx -t && systemctl reload nginx
          
          echo "‚úÖ Deployment completed successfully!"
          echo "üåê Site available at: http://89.111.155.196"
        EOF
